# ë°ë¹„&ë§ˆë¥¼ë Œ Discord ë´‡

ì´í„°ë„ë¦¬í„´(Eternal Return) ë°ë¹„&ë§ˆë¥¼ë Œ í…Œë§ˆ Discord ë´‡ì…ë‹ˆë‹¤. Google Cloud Platform(GCP)ì—ì„œ ì‹¤í–‰ë˜ë©° ì›¹ ê´€ë¦¬ íŒ¨ë„(ì›¹/ë°ìŠ¤í¬í†±)ì„ í†µí•´ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### Discord ë´‡ ê¸°ëŠ¥
- **ìë™ ì•Œë¦¼**: ì´í„°ë„ë¦¬í„´ ê³µì‹ YouTube ìë™ ì•Œë¦¼ (5ë¶„ë§ˆë‹¤ ì²´í¬)
- **ì „ì  ê²€ìƒ‰**: `/ì „ì ` ëª…ë ¹ì–´ë¡œ ì‹¤í—˜ì²´, í†µê³„(MMR ê·¸ë˜í”„) ì¡°íšŒ
- **ì„œë²„ ê´€ë¦¬**: ê³µì§€ ì±„ë„ ì„¤ì •, ìœ íŠœë¸Œ ì•Œë¦¼ êµ¬ë… ê´€ë¦¬
- **AI ëŒ€í™”**: ë°ë¹„ì™€ ë§ˆë¥¼ë Œ ìºë¦­í„° í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ëŒ€í™” ê¸°ëŠ¥
- **DM ì±„ë„ ìë™ ìƒì„±**: ë´‡ê³¼ ìƒí˜¸ì‘ìš©í•œ ìœ ì €ì˜ DM ì±„ë„ ìë™ ì €ì¥

### ì›¹ ê´€ë¦¬ íŒ¨ë„ (React + Flask)
- **ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**: ë´‡ ìƒíƒœ, ì„œë²„ ìˆ˜, ì‚¬ìš©ì í†µê³„ ëª¨ë‹ˆí„°ë§
- **Discord ìŠ¤íƒ€ì¼ UI**: ì‹¤ì œ Discordì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤
- **DM ì±„íŒ… ì¸í„°í˜ì´ìŠ¤**: ì›¹ì—ì„œ ì§ì ‘ Discord DM ì£¼ê³ ë°›ê¸°
- **ì„œë²„/ì±„ë„ ê´€ë¦¬**: ë´‡ì´ ì°¸ì—¬í•œ ì„œë²„ ë° ì±„ë„ ëª©ë¡
- **ì‹¤ì‹œê°„ Gateway ì—°ê²°**: Discord Gatewayë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
- **GCS ì„¤ì • ë·°ì–´**: Google Cloud Storageì— ì €ì¥ëœ ì„¤ì • íŒŒì¼ ì‹¤ì‹œê°„ ì¡°íšŒ
- **Electron ë°ìŠ¤í¬í†± ì•±**: ì›¹íŒ¨ë„ì„ ë°ìŠ¤í¬í†± ì•±ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Discord Bot   â”‚    â”‚   Web Panel     â”‚    â”‚  Google Cloud   â”‚
â”‚  (Cloud Run)    â”‚â—„â”€â”€â–ºâ”‚  (Cloud Run)    â”‚â—„â”€â”€â–ºâ”‚   Storage       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloud Logging   â”‚    â”‚  Electron App   â”‚    â”‚ Secret Manager  â”‚
â”‚ (ë¡œê·¸ ìˆ˜ì§‘)      â”‚    â”‚ (Desktop Panel) â”‚    â”‚ (í™˜ê²½ ë³€ìˆ˜)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” ì»´í¬ë„ŒíŠ¸
- **Discord Bot**: Python ê¸°ë°˜, Cloud Runì—ì„œ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰
- **Web Panel**: React + Flask, Discord Gateway ì‹¤ì‹œê°„ ì—°ê²°
- **Electron App**: ì›¹íŒ¨ë„ì˜ ë°ìŠ¤í¬í†± ë²„ì „ (macOS/Windows)
- **Google Cloud Run**: ì„œë²„ë¦¬ìŠ¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™˜ê²½
- **Google Cloud Storage (GCS)**: ë´‡ ì„¤ì • ë° DM ì±„ë„ ì •ë³´ ì €ì¥
- **Google Container Registry (GCR)**: Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ
- **Cloud Logging**: ë¡œê·¸ ìˆ˜ì§‘ ë° ëª¨ë‹ˆí„°ë§

## ğŸš€ ë°°í¬ ë° ìš´ì˜

### Cloud Run ì„œë¹„ìŠ¤
1. **debi-marlene-bot**: Discord ë´‡ ë©”ì¸ ì„œë¹„ìŠ¤
2. **debi-marlene-webpanel**: ì›¹ ê´€ë¦¬ íŒ¨ë„ ì„œë¹„ìŠ¤

### Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ë°°í¬
```bash
# ë´‡ ì´ë¯¸ì§€ ë¹Œë“œ
cd /Users/kasa/Desktop/ëª¨ë¬˜ëª¨/debi-marlene
docker build --no-cache --platform linux/amd64 -f Dockerfile -t gcr.io/[PROJECT_ID]/debi-marlene-bot:v1 .

# GCRì— í‘¸ì‹œ
docker push gcr.io/[PROJECT_ID]/debi-marlene-bot:v1

# Cloud Run ë°°í¬
gcloud run deploy debi-marlene-bot \
  --image gcr.io/[PROJECT_ID]/debi-marlene-bot:v1 \
  --platform managed \
  --region asia-northeast3 \
  --set-env-vars DISCORD_TOKEN=[TOKEN],YOUTUBE_API_KEY=[KEY] \
  --memory 512Mi \
  --cpu 1
```

### ì›¹íŒ¨ë„ ë°°í¬
```bash
# ì›¹íŒ¨ë„ ì´ë¯¸ì§€ ë¹Œë“œ
docker build --no-cache --platform linux/amd64 -f webpanel/Dockerfile -t gcr.io/[PROJECT_ID]/debi-marlene-webpanel:v1 .

# GCRì— í‘¸ì‹œ
docker push gcr.io/[PROJECT_ID]/debi-marlene-webpanel:v1

# Cloud Run ë°°í¬
gcloud run deploy debi-marlene-webpanel \
  --image gcr.io/[PROJECT_ID]/debi-marlene-webpanel:v1 \
  --platform managed \
  --region asia-northeast3 \
  --port 8080 \
  --set-env-vars DISCORD_BOT_TOKEN=[TOKEN],DISCORD_CLIENT_ID=[ID],DISCORD_CLIENT_SECRET=[SECRET] \
  --memory 512Mi \
  --cpu 1 \
  --allow-unauthenticated
```

### í™˜ê²½ ë³€ìˆ˜ (Cloud Run Environment Variables)
```
DISCORD_TOKEN: Discord ë´‡ í† í°
CLAUDE_API_KEY: Anthropic Claude API í‚¤
YOUTUBE_API_KEY: YouTube Data API í‚¤
EternalReturn_API_KEY: ì´í„°ë„ë¦¬í„´ API í‚¤
OWNER_ID: ë´‡ ì†Œìœ ì Discord ID
DISCORD_CLIENT_ID: Discord OAuth í´ë¼ì´ì–¸íŠ¸ ID
DISCORD_CLIENT_SECRET: Discord OAuth í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿
DISCORD_REDIRECT_URI: OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ URI
GOOGLE_APPLICATION_CREDENTIALS: GCS ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ê²½ë¡œ (ë¡œì»¬ ê°œë°œìš©)
```

## ğŸ› ï¸ ê°œë°œ í™˜ê²½ ì„¤ì •

### ë¡œì»¬ ê°œë°œ
```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone <repository-url>
cd debi-marlene

# Python ì˜ì¡´ì„± ì„¤ì¹˜
pip install --break-system-packages google-cloud-storage discord.py Flask Flask-CORS

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì— í•„ìš”í•œ API í‚¤ë“¤ ì…ë ¥

# ë´‡ ì‹¤í–‰
python3 main.py

# ì›¹íŒ¨ë„ ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)
cd webpanel
python3 web_panel.py      # Flask ì„œë²„ (í¬íŠ¸ 8080)
npm run dev               # Vite ê°œë°œ ì„œë²„ (í¬íŠ¸ 5173)

# Electron ë°ìŠ¤í¬í†± ì•± ì‹¤í–‰
npm run electron:dev
```

### GCS ì¸ì¦ ì„¤ì •
```bash
# ë¡œì»¬ ê°œë°œ í™˜ê²½
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"

# ë˜ëŠ” gcloud CLI ì¸ì¦
gcloud auth application-default login

# GCS ë²„í‚· í™•ì¸
gsutil ls gs://debi-marlene-settings/
gsutil cat gs://debi-marlene-settings/settings.json
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
debi-marlene/
â”œâ”€â”€ main.py                     # ë´‡ ë©”ì¸ ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ run/                        # ë´‡ í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ discord_bot.py          # Discord ë´‡ ë¡œì§, Gateway ì—°ë™
â”‚   â”œâ”€â”€ youtube_service.py      # YouTube API ì—°ë™, ì•Œë¦¼ ì „ì†¡
â”‚   â”œâ”€â”€ config.py               # GCS ì„¤ì • ê´€ë¦¬, DM ì±„ë„ ì €ì¥
â”‚   â”œâ”€â”€ api_clients.py          # ì´í„°ë„ë¦¬í„´ API í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ graph_generator.py      # MMR ê·¸ë˜í”„ ìƒì„±
â”‚   â””â”€â”€ recent_games_image_generator.py  # ìµœê·¼ ì „ì  ì´ë¯¸ì§€
â”œâ”€â”€ webpanel/                   # ì›¹ ê´€ë¦¬ íŒ¨ë„ (React + Flask)
â”‚   â”œâ”€â”€ web_panel.py            # Flask ë°±ì—”ë“œ API
â”‚   â”œâ”€â”€ discord_gateway_service.py  # Discord Gateway ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ src/                    # React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”‚   â”œâ”€â”€ components/         # UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ DiscordApp.tsx  # ë©”ì¸ Discord UI
â”‚   â”‚   â”‚   â”œâ”€â”€ ServerList.tsx  # ì„œë²„ ëª©ë¡
â”‚   â”‚   â”‚   â”œâ”€â”€ ChannelList.tsx # ì±„ë„ ëª©ë¡
â”‚   â”‚   â”‚   â””â”€â”€ MessageArea.tsx # ë©”ì‹œì§€ ì˜ì—­
â”‚   â”‚   â””â”€â”€ App.tsx             # React ë©”ì¸
â”‚   â”œâ”€â”€ electron/               # Electron ë°ìŠ¤í¬í†± ì•±
â”‚   â”‚   â””â”€â”€ main.cjs            # Electron ë©”ì¸ í”„ë¡œì„¸ìŠ¤
â”‚   â”œâ”€â”€ splash.html             # ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°
â”‚   â”œâ”€â”€ package.json            # Node.js ì˜ì¡´ì„±
â”‚   â”œâ”€â”€ requirements.txt        # Python ì˜ì¡´ì„±
â”‚   â”œâ”€â”€ Dockerfile              # ì›¹íŒ¨ë„ Docker ì´ë¯¸ì§€
â”‚   â””â”€â”€ run/                    # ì‹¬ë³¼ë¦­ ë§í¬ (ë´‡ ëª¨ë“ˆ)
â”œâ”€â”€ assets/                     # ì´ë¯¸ì§€ ë° ì •ì  ìì›
â”œâ”€â”€ requirements.txt            # ë´‡ Python ì˜ì¡´ì„±
â”œâ”€â”€ Dockerfile                  # ë´‡ Docker ì´ë¯¸ì§€
â”œâ”€â”€ CLAUDE.md                   # í”„ë¡œì íŠ¸ ê°€ì´ë“œ (ê°œë°œììš©)
â””â”€â”€ README.md                   # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ğŸ”§ ìµœê·¼ ì—…ë°ì´íŠ¸

### 2025-10-20
- âœ… **Duet AI êµ¬ë… ì·¨ì†Œ**: Google Cloud Duet AI ë¹„í™œì„±í™”ë¡œ ë¹„ìš© ì ˆê°
- âœ… **DM ì±„ë„ ìë™ ìƒì„±**: `get_interaction_users()` í•¨ìˆ˜ì—ì„œ ìë™ìœ¼ë¡œ DM ì±„ë„ ìƒì„± ë° GCS ì €ì¥

### 2025-10-15 (2)
- âœ… **Electron ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°**: Discord ìŠ¤íƒ€ì¼ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
- âœ… **UI ì´ëª¨ì§€ ì œê±°**: ì›¹íŒ¨ë„ì—ì„œ ë¶ˆí•„ìš”í•œ ì´ëª¨ì§€ ì œê±°
- âœ… **ìƒíƒœ ì§€ì†ì„±**: localStorageë¥¼ ì‚¬ìš©í•œ ì„œë²„/ì±„ë„ ì„ íƒ ìƒíƒœ ì €ì¥

### 2025-10-15 (1)
- âœ… **GCS Rate Limit í•´ê²°**: ì±„íŒ… ë¡œê·¸ ì €ì¥ ê¸°ëŠ¥ ì œê±°
- âœ… **ì–‘ë°©í–¥ DM ì €ì¥**: ë´‡ â†’ ìœ ì € DMë„ ìë™ìœ¼ë¡œ GCSì— ì €ì¥

### 2025-10-14
- âœ… **DM ì±„ë„ ìë™ ì €ì¥**: DM ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ìë™ìœ¼ë¡œ ì±„ë„ ì •ë³´ GCS ì €ì¥
- âœ… **ì›¹íŒ¨ë„ Gateway ì„œë¹„ìŠ¤**: Discord Gateway ì‹¤ì‹œê°„ ì—°ê²°

### 2025-10-06 (2)
- âœ… **ë´‡ í”„ë¡œí•„ ë™ì  ë¡œë”©**: `/api/bot-info` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€

### 2025-10-06 (1)
- âœ… **GCS ì„¤ì • ë·°ì–´**: ì›¹íŒ¨ë„ì—ì„œ GCS settings.json ì‹¤ì‹œê°„ í™•ì¸

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

1. **ModuleNotFoundError: No module named 'google.cloud.storage'**
   ```bash
   pip install google-cloud-storage
   # ë˜ëŠ”
   pip install --break-system-packages google-cloud-storage  # macOS
   ```

2. **GCS ì¸ì¦ ì‹¤íŒ¨ (403 Forbidden)**
   ```bash
   # ë¡œì»¬: í™˜ê²½ë³€ìˆ˜ ì„¤ì •
   export GOOGLE_APPLICATION_CREDENTIALS="/path/to/service-account-key.json"

   # Cloud Run: IAM ê¶Œí•œ ë¶€ì—¬
   gcloud projects add-iam-policy-binding [PROJECT_ID] \
     --member="serviceAccount:[SERVICE_ACCOUNT]@[PROJECT_ID].iam.gserviceaccount.com" \
     --role="roles/storage.objectAdmin"
   ```

3. **DM ì±„ë„ì´ ì›¹íŒ¨ë„ì— í‘œì‹œë˜ì§€ ì•ŠìŒ**
   - ë´‡ì—ê²Œ DM ë©”ì‹œì§€ ì „ì†¡ â†’ ìë™ìœ¼ë¡œ GCSì— ì €ì¥ë¨
   - GCS `settings.json`ì˜ `users` ì„¹ì…˜ì— `dm_channel_id` í™•ì¸
   - ì›¹íŒ¨ë„ DM ëª©ë¡ ìë™ ìƒˆë¡œê³ ì¹¨ (10ì´ˆë§ˆë‹¤)

4. **ë°°í¬ í›„ ë³€ê²½ì‚¬í•­ ë¯¸ë°˜ì˜**
   ```bash
   # Docker ì´ë¯¸ì§€ ìºì‹œ ì—†ì´ ì¬ë¹Œë“œ
   docker build --no-cache --platform linux/amd64 -f Dockerfile -t gcr.io/[PROJECT_ID]/bot:v2 .

   # Cloud Run ìµœì‹  ë¦¬ë¹„ì „ìœ¼ë¡œ íŠ¸ë˜í”½ ì „í™˜
   gcloud run services update-traffic debi-marlene-bot --to-latest
   ```

### ëª¨ë‹ˆí„°ë§ ëª…ë ¹ì–´

```bash
# Cloud Run ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
gcloud run services list
gcloud run services describe debi-marlene-bot --region asia-northeast3

# ë¡œê·¸ í™•ì¸
gcloud run services logs read debi-marlene-bot --region=asia-northeast3 --limit=50
gcloud run services logs tail debi-marlene-bot --region=asia-northeast3  # ì‹¤ì‹œê°„

# GCS ì„¤ì • í™•ì¸
gsutil cat gs://debi-marlene-settings/settings.json
```

## ğŸŒ ë°°í¬ í™˜ê²½

- **í´ë¼ìš°ë“œ í”Œë«í¼**: Google Cloud Platform (GCP)
- **ì»¨í…Œì´ë„ˆ ì‹¤í–‰**: Cloud Run (ì„œë²„ë¦¬ìŠ¤)
- **ìŠ¤í† ë¦¬ì§€**: Cloud Storage (`debi-marlene-settings` ë²„í‚·)
- **ì´ë¯¸ì§€ ì €ì¥ì†Œ**: Google Container Registry (GCR)
- **ë¡œê¹…**: Cloud Logging
- **ë¦¬ì „**: asia-northeast3 (ì„œìš¸)

## ğŸ“ ì§€ì›

- **GitHub Issues**: ë²„ê·¸ ë¦¬í¬íŠ¸ ë° ê¸°ëŠ¥ ìš”ì²­
- **Discord**: ë´‡ ê´€ë ¨ ë¬¸ì˜ ë° ì§€ì›
- **ì›¹ íŒ¨ë„**: ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬

## ğŸ® í–¥í›„ ê°œë°œ ê³„íš (v1.1+)

### ë´‡ ê¸°ëŠ¥
- ëª¨ë°”ì¼ ì•± ê°œë°œ (iOS/Android)
- AI ëŒ€í™” ê¸°ëŠ¥ ê°•í™” (GPT/Claude API)
- ì „ì  ë¶„ì„ ê¸°ëŠ¥ (ê²Œì„ë³„ í†µê³„)

### ì›¹íŒ¨ë„ ê¸°ëŠ¥
- ì„œë²„ ëª©ë¡ í´ë” ê¸°ëŠ¥
- ì„œë²„/ì±„ë„ ìœ„ì¹˜ ë°”ê¾¸ê¸° (ë“œë˜ê·¸ ì•¤ ë“œë¡­)
- ì‚¬ìš©ì ìƒíƒœì°½ êµ¬í˜„ (í”„ë¡œí•„, ì—­í• , ìƒíƒœ)
- ì›¹ í„°ë¯¸ë„ ê¸°ëŠ¥ (ì‹¤ì‹œê°„ ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°)

---

> ì´ ë´‡ì€ ì´í„°ë„ë¦¬í„´ì˜ ë°ë¹„&ë§ˆë¥¼ë Œ ìºë¦­í„°ë¥¼ í…Œë§ˆë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ®âœ¨
